Array.prototype.remove=function(b){for(var a=0;a<this.length;a++){if(b==this[a]){this.splice(a,1)}}};function Map(){this.keys=new Array();this.data=new Object();this.put=function(a,b){if(this.data[a]==null){this.keys.push(a)}this.data[a]=b};this.get=function(a){return this.data[a]};this.remove=function(a){this.keys.remove(a);this.data[a]=null};this.each=function(d){if(typeof d!="function"){return}var a=this.keys.length;for(var c=0;c<a;c++){var b=this.keys[c];d(b,this.data[b],c)}};this.entrys=function(){var a=this.keys.length;var c=new Array(a);for(var b=0;b<a;b++){c[b]={key:this.keys[b],value:this.data[b]}}return c};this.isEmpty=function(){return this.keys.length==0};this.size=function(){return this.keys.length};this.toString=function(){var c="{";for(var b=0;b<this.keys.length;b++,c+=","){var a=this.keys[b];c+=a+"="+this.data[a]}c+="}";return c}}(function(f,i,j,c){var d={width:400,height:300,emojiValueId:"emoji_value",emojiSendId:"emoji_send",emojiFace:[{id:"rabbit",value:"rabbit",name:"鱼妹兔",desc:"鱼妹兔"},{id:"leon",value:"leon",name:"绿豆蛙",desc:"绿豆蛙"},{id:"qiubi",value:"qiubi",name:"丘比龙",desc:"丘比龙"},{id:"weibo",value:"weibo",name:"微博",desc:"微博"}]};var g={emojiId:"emoji",showEmojiId:"show_emoji",emojiBtnId:"emoji-tbtn",emojiInnerId:"emoji_inner",emojiThumbnailId:"emoji_thumbnail",emojiBodyId:"emoji_body",emojiCloseId:"emoji_close",emojiHeaderId:"emoji_header",loadingId:"loading"};var h="";var k=0;var e=d.emojiFace[0].value;var a=function(l){var m=f(this);f("#"+g.emojiId).bind({click:function(n){n.stopPropagation()}}).delegate("#"+g.emojiBtnId,{mouseover:function(n){b.loadEmoji(f("#"+g.emojiBodyId),e);f("."+e+"_img").show();f("#"+g.emojiInnerId).show();n.preventDefault()}}).delegate("#"+g.emojiCloseId,{click:function(n){f("#"+g.emojiInnerId).hide()}}).delegate("#"+g.emojiHeaderId+" li",{mouseover:function(o){var n=f(this).parent().find(".emoji_active");if(n){f(n).removeClass("emoji_active");f("."+f(n).attr("value")+"_img").hide()}var p=f(this).attr("value");f(this).addClass("emoji_active");e=p;b.loadEmoji(f("#"+g.emojiBodyId),p);f("."+p+"_img").show()}}).delegate("#"+g.showEmojiId,{click:function(n){alert("sds")},focus:function(){if(i.getSelection&&i.getSelection().getRangeAt){var n=i.getSelection();f("#"+g.showEmojiId).emoji("range",n)}}}).delegate("#"+g.emojiBodyId+" li img",{click:function(n){f("#"+g.showEmojiId).emoji("innsertHtml",'<img alt="" lang="'+f(this).attr("lang")+'" class="show_area_img" src="'+f(this).attr("src")+'" >')},mouseover:function(p){var s=p.target||p.srcElement;var q=f(s).parent().parent().parent();var o=p.clientX;var r=f(q).offset().left;var n=f(q).width();if((o-r)>n/2){f("#"+g.emojiThumbnailId).css("right","").css("left","1px")}else{f("#"+g.emojiThumbnailId).css("left","").css("right","1px")}f("#"+g.emojiThumbnailId+" img").attr("src",f(this).attr("src"));f("#"+g.emojiThumbnailId).show()},mouseleave:function(n){f("#"+g.emojiThumbnailId).hide()}}).delegate("#"+g.emojiInnerId,{mouseleave:function(n){f(this).hide()}}).delegate("#"+l.emojiSendId,{click:function(o){var n=f("#"+g.showEmojiId).html();n=n.replace(/(<img[\s\S]+?>)/g,function(p){var q=p.match(/\[\S*\]/g);return q});l.callback.call(this.callback,n)}})};var b={init:function(l){return this.each(function(){var u=f(this);l=f.extend({},d,l||{});var n=l.width;var y=l.height;var m=f("<div></div>").attr({"id":g.showEmojiId,"class":"emoji_area","contenteditable":"true"}).css({"width":n+"px","height":y+"px"});u.append(m);var r=m.attr("id");var z=f("<div></div>").attr({"id":g.emojiId,"class":"emoji-container"}).css({"width":(n)+"px"});u.append(z);z.append("<img alt='smiling' src='images/emoji.png' id='emoji-tbtn' id='"+g.emojiBtnId+"'  class='emoji-tbtn'>");var v=f("<input type='hidden' />").attr("id",l.emojiValueId);z.append(v);z.append('<div id="'+l.emojiSendId+'" class="emoji_send">发布</div>');var s=422;if(n<=400){s=315}else{if(n>400&&n<=500){s=422}else{if(n>500){s=485}}}var o=f("<div class='emoji_inner' id='"+g.emojiInnerId+"'></div>").css({"width":s+"px"});z.append(o);o.append('<div class="emoji_wrap"><div class="emoji_wrap1"></div><div class="emoji_wrap2"></div></div>');o.append('<div class="emoji_close" id="'+g.emojiCloseId+'"></div>');var q=l.emojiFace;if(q.length<=0){return}var x="";for(var p=0;p<q.length;p++){var t=q[p];if(p==0){x+='<li class="emoji_active" id="'+t.id+'" value="'+t.value+'">'+t.name+"</li>"}else{x+='<li class="" id="'+t.id+'" value="'+t.value+'">'+t.name+"</li>"}}o.append('<div class="emoji_header" id="'+g.emojiHeaderId+'"><ul>'+x+"</ul></div>");var w=f('<div class="emoji_body" id="'+g.emojiBodyId+'"></div>');o.append(w);a(l)})},close:function(){},parse:function(l){h=l.replace(/\[/g,'<img src="images/').replace(/]/g,'">');return this},loadEmoji:function(n,r){b.loading(f("#"+g.emojiInnerId));var p='<div class="emoji_thumbnail" id="'+g.emojiThumbnailId+'"><img id="emoji_thumbnail" alt="" src="images/emoji.png"></div>';p+='<ul class="emoji_img  '+r+'_img" id="'+r+'_img"></ul>';n.html(p);var m=f("#"+r+"_img");var l="";
for(var o=0;o<map.get(r).length;o++){var q=map.get(r)[o];l+='<li class="small_li"><img class="small_img" alt="" lang="['+r+"/"+q.url+']" src="images/'+r+"/"+q.url+'"/></li>'}m.html(l);b.removeLoading(g.loadingId)},loading:function(n){var m=n.width();var l=n.height();var o=f("<div id='"+g.loadingId+"'><img title='加载中...' src='images/loading.gif' ></div>");o.css({"position":"absolute","left":(m/2-20)+"px","top":(l/2)+"px"});n.append(o)},removeLoading:function(l){f("#"+l).remove()},range:function(m){var l;l=m.getRangeAt(0);return l},innsertHtml:function(p){var q=f(this);var l,o;if(!q.hasfocus){q.focus()}if(i.getSelection&&i.getSelection().getRangeAt){var n=i.getSelection();l=b.range(n);l.collapse(false);o=l.createContextualFragment(p);var r=o.lastChild;l.insertNode(o);if(r){l.setEndAfter(r);l.setStartAfter(r)}var m=i.getSelection();m.removeAllRanges();m.addRange(l)}else{if(j.selection&&j.selection.createRange){j.selection.createRange().pasteHTML(text)}else{this.value+=myValue;this.focus()}}}};f.fn.emoji=function(){var m=arguments[0];var l={};if(b[m]){m=b[m];l=arguments[1]}else{if(typeof m==="object"){l=arguments[0];m=b.init}else{if(!m){console.log("调用错误");m=b.init}}}return m.call(this,l)};f.fn.parseValue=function(){return h}})(jQuery,window,document);
